# 实践课6 - 功能拓展

## 关于拓展性

经过项目整体重构, 我们在功能拓展方面任务量也减少了很多.

由于现在的项目数据流是单向 + 基于Message类型的(请参考<a href="./项目架构.md">架构文档</a>), 所以我们在拓展功能时, 所做的就是添加或修改若干种不同类型的 Message, 然后为其添加对应的Handler用于处理.

我们组内的分工是: 

- 将保存到文件, 归档压缩做成一个模块, 或者集成到现有的模块中(如PM模块). 
- 之后, 在对应的Handler中做修改, 添加对应的事件.

例如: 我们需要添加保存消息到文件, 我们对PM模块做了如下修改:

首先, 由于复用了其他组的jar包, 我们会对其进行一定的封装, 详见 TeamSeven.util.performance 包.

然后, 在封装好的类中增加拓展性功能, 例如zip等, 其中定时zip这个功能专门做成一个package, 包含一个ZipManager.

最后, 将相应的代码修改apply到对应的Handler中.

## 关于功能实现的说明

这次任务继续使用第九组的pm构件, 构件新增了两项功能: 写文件操作和文件压缩

对构件的内部逻辑稍加了解之后, 知道是将所有使用pm构件新建的文件的路径添加到待压缩文件列表, 然后对列表中到文件进行压缩, 所以在实现定时压缩的功能时, 会遇到以下两个问题:

- 如果只是简单地加上定时器, 那么服务端或用户端退出前未被压缩的文件没办法在下次开启时压缩
- 构件提供了resetCompass方法来清空压缩文件列表, 来避免压缩的重复, 但是记录消息时一直是追加写入, 所以第一次被压缩之后, 记录消息的文件就不再被压缩

解决方案是:

- 除了定时压缩之外, 在服务端或用户端退出时将未被压缩的文件全部进行压缩
- 每次压缩后新建一个文件用于之后的消息记录
- （和第九组沟通, 改善压缩功能, 每次写文件操作时判断文件是否在压缩文件列表中）

所以添加zipManager类, 来处理和打包功能相关的定时器和压缩时的相关操作.

## 实现上的不足

其实zip归档功能可以直接提出来, 专门作为一个模块, 也就是说, 不必耦合在PM模块下, 而是应该单独提取出来使用.

另外, 需求中说: 压缩格式不限, 但是从可复用性上考虑, 是不是可以考虑支持多类型的压缩方式?


